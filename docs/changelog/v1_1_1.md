# Version mineure 1.1.1

*Date de publication : 17 novembre 2023.*

*Sur GitHub : [https://github.com/MTES-MCT/metadata-postgresql/releases/tag/v1.1.1](https://github.com/MTES-MCT/metadata-postgresql/releases/tag/v1.1.1).*

Plume v1.1.1 apporte des corrections lors de la première installation dans le cas où la bilbiothèque rdflib n'est pas installée, et de petites améliorations fonctionnelles.  


## La version 1.1.0 plante à la première installation (manque module rdfLib)
La version 1.1.0 diffusée, déclenche un message d'erreur du type "Manque module rdflib" à la première installation

*Référence : [issue #177](https://github.com/MTES-MCT/metadata-postgresql/issues/177).*

## Prise en charge des calculs sans résultat
Lorsque la fonctionnalité de calcul de métadonnées côté serveur ne renvoie pas de résultat, la retranscription dans les fiches de métadonnées présente des anomalies.

*Référence : [issue #176](https://github.com/MTES-MCT/metadata-postgresql/issues/176).*

## Réduire la taille de l'archive contenant le plugin QGIS
Modification de la fonction admin.zip_plume.zip_plume pour qu'elle compresse l'archive générée.

*Référence : [issue #175](https://github.com/MTES-MCT/metadata-postgresql/issues/175).*

## Codes invalides dans les valeurs du paramètre langList
Les codes de langues listés dans le paramètre utilisateur Langues autorisées pour les traductions / langList devaient être séparés par des virgules sans aucun espace.
Toutefois, l'interface le permettait et il n'y avait pas de contrôle, ce qui est désormais corrigé.

*Référence : [issue #174](https://github.com/MTES-MCT/metadata-postgresql/issues/174).*

## Import CSW - Avertir l'utilisateur lorsque la réponse ne contient pas de métadonnées
La solution mise en œuvre pour remonter les erreurs renvoyées par le serveur CSW ne fonctionnent pas dans le cas où l'identifiant fourni n'a pas été reconnu, car - pour un CSW 2.0.2 - il n'y a pas d'erreur dans ce cas. La réponse est un XML valide qui contient bien un élément csw:GetRecordByIdResponse, mais simplement aucun élément gmd:MD_Metadata..

*Référence : [issue #172](https://github.com/MTES-MCT/metadata-postgresql/issues/172).*

## Démultiplication du panneau Plume
On pouvait ouvrir plusieurs instances de Plume en cliquant plusieurs fois sur l'icone de Plume. c'est désormais corrigé, une fois ouverte, L'icone de Plume reste affichée mais est désactivée.

*Référence : [issue #171](https://github.com/MTES-MCT/metadata-postgresql/issues/171).*


## Compatibilité

Plume v1.1.1 est la première version de Plume dont la compatibilité avec la [version 16](https://www.postgresql.org/docs/16/release-16.html) de PostgreSQL, sortie le 14 septembre 2023, a été confirmée. *Référence : [issue #165](https://github.com/MTES-MCT/metadata-postgresql/issues/165).*

Plume v1.1.1 est compatible avec la [version 7.0.0](https://github.com/RDFLib/rdflib/releases/tag/7.0.0) de RDFLib, publiée le 2 août 2023 et dernière version disponible. La version intégrée reste toutefois la v6.3.2, car la v7.0.0 n'assure plus la compatibilité avec Python 3.7, qui était couramment utilisée dans les distributions de QGIS au moins jusqu'à la version 3.18. Il n'en est pas moins possible de mettre à jour RDFLib manuellement. *Référence : [issue #168](https://github.com/MTES-MCT/metadata-postgresql/issues/168).*

D'une manière générale, tous les tests de Plume sont effectués dans un environnement Windows 10. La compatibilité avec une installation de QGIS sous Linux ou Mac n'est pas garantie. La version 1.1.1 a néanmoins apporté quelques corrections qui semblent permettre l'usage de Plume dans un contexte Linux. Les utilisateurs de Linux et Mac sont encouragés à signaler via des issues les éventuelles difficultés rencontrées. *Référence : [issue #169](https://github.com/MTES-MCT/metadata-postgresql/issues/169).*

Le tableau ci-après détaille plus précisément les conditions de test des mécaniques internes (PlumePg 0.3.0 et packages `plume.iso`, `plume.rdf`, `plume.pg` de Plume 1.1.1). Tous les tests ont de plus été réalisés avec [Asgard](https://github.com/MTES-MCT/asgard-postgresql) 1.4.0, [pgcrypto](https://www.postgresql.org/docs/current/pgcrypto.html) 1.3, [isodate](https://pypi.org/project/isodate/) 0.6.1 et [six](https://pypi.org/project/six/) 1.16.0.

| [PostgreSQL](https://www.postgresql.org/) | [Python](https://www.python.org/) | [psycopg2](https://pypi.org/project/psycopg2/) | [RDFLib](https://pypi.org/project/rdflib/) | [pyparsing](https://pypi.org/project/pyparsing/) | [importlib-metadata](https://pypi.org/project/importlib-metadata/) | [zipp](https://pypi.org/project/zipp/) | [typing-extensions](https://pypi.org/project/typing-extensions/)
| --- | --- | --- | --- | --- | --- | --- | --- |
| **12.6** | 3.9.5 | 2.9.9 | 6.3.2 | 3.0.9 | - | - | - |
| **13.2** | 3.9.5 | 2.9.9 | 6.3.2 | 3.0.9 | - | - | - |

## Distribution Debian de PlumePg

L'extension PostgreSQL PlumePg, dont la version 0.3.0 reste la référence pour Plume v1.1.1, est désormais distribuée sous la forme d'un paquet Debian joint à la *release*, en plus des formats habituels. Ce format, qui est nécessaire à la mise à disposition de PlumePg sur les serveurs de l'offre [EcoSQL](https://spote.developpement-durable.gouv.fr/offre/ecosql-postgresql) sera systématiquement proposé à l'avenir.

*Référence : [issue #149](https://github.com/MTES-MCT/metadata-postgresql/issues/149).*

## Corrections d'anomalies et divers
