
<!DOCTYPE html>

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Génération du dictionnaire des widgets &#8212; Documentation Plume 0.3.0-beta</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Création d’un nouveau widget" href="creation_widgets.html" />
    <link rel="prev" title="Usage" href="usage.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="generation-du-dictionnaire-des-widgets">
<h1>Génération du dictionnaire des widgets<a class="headerlink" href="#generation-du-dictionnaire-des-widgets" title="Lien permanent vers ce titre">¶</a></h1>
<p><span class="xref myst">metagraph : le graphe des métadonnées pré-existantes</span> • <span class="xref myst">template : le modèle de formulaire</span> • <span class="xref myst">columns : les descriptifs des champs</span> • <span class="xref myst">data : les métadonnées calculées</span> • <span class="xref myst">mode</span> • <span class="xref myst">translation</span> • <span class="xref myst">langList</span> • <span class="xref myst">language</span> • <span class="xref myst">readHideBlank</span> • <span class="xref myst">editHideUnlisted</span> • <span class="xref myst">readHideUnlisted</span> • <span class="xref myst">editOnlyCurrentLanguage</span> • <span class="xref myst">readOnlyCurrentLanguage</span> • <span class="xref myst">labelLengthLimit</span> • <span class="xref myst">valueLengthLimit</span> • <span class="xref myst">textEditRowSpan</span> • <span class="xref myst">Résultat : un dictionnaire de widgets</span></p>
<p>Lorsqu’un utilisateur demande l’affichage de la fiche de métadonnées d’une table ou vue, le plugin :</p>
<ol class="arabic simple">
<li><p>rassemble dans un « dictionnaire de widgets », c’est-à-dire un objet de classe <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code>, des informations issues de toutes sortes de sources, incluant évidemment les métadonnées de la table stockées dans son descriptif PostgreSQL ;</p></li>
<li><p>parcourt ce dictionnaire de widgets pour construire le formulaire qui sera présenté à l’utilisateur.</p></li>
</ol>
<p>La première de ces étapes est traitée ici. Pour la seconde, cf. <span class="xref myst">Création d’un nouveau widget</span>.</p>
<p>La classe <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code> est définie par le module <span class="xref myst">plume.rdf.widgetsdict</span>. Sa fonction d’initialisation prend deux types d’arguments : des sources de données et des paramètres utilisateur. Aucun n’est obligatoire.</p>
<p>Sources de données :</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Nom</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Valeur par défaut</p></th>
<th class="head"><p>Détails</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">metagraph</span></code></p></td>
<td><p><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">plume.rdf.metagraph.Metagraph</span></code></span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><span class="xref myst">→ graphe des métadonnées</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">template</span></code></p></td>
<td><p><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">plume.pg.template.TemplateDict</span></code></span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><span class="xref myst">→ modèle de formulaire</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dict</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><span class="xref myst">→ métadonnées calculées</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">columns</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">list(tuple(str,</span> <span class="pre">str))</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p><span class="xref myst">→ descriptifs des champs</span></p></td>
</tr>
</tbody>
</table>
<p>Paramètres utilisateurs :</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Nom</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Valeur par défaut</p></th>
<th class="head"><p>Détails</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mode</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">str</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'edit'</span></code></p></td>
<td><p><span class="xref myst">→</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">translation</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">False</span></code></p></td>
<td><p><span class="xref myst">→</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">langList</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">list(str)</span></code> ou <code class="docutils literal notranslate"><span class="pre">tuple(str)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">('fr',</span> <span class="pre">'en')</span></code></p></td>
<td><p><span class="xref myst">→</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">language</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">str</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'fr'</span></code></p></td>
<td><p><span class="xref myst">→</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">readHideBlank</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
<td><p><span class="xref myst">→</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">editHideUnlisted</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">False</span></code></p></td>
<td><p><span class="xref myst">→</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">readHideUnlisted</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
<td><p><span class="xref myst">→</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">editOnlyCurrentLanguage</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">False</span></code></p></td>
<td><p><span class="xref myst">→</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">readOnlyCurrentLanguage</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
<td><p><span class="xref myst">→</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">labelLengthLimit</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">25</span></code></p></td>
<td><p><span class="xref myst">→</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">valueLengthLimit</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">65</span></code></p></td>
<td><p><span class="xref myst">→</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">textEditRowSpan</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">6</span></code></p></td>
<td><p><span class="xref myst">→</span></p></td>
</tr>
</tbody>
</table>
<p>Tous les arguments sont décrits plus en détail dans la suite, ainsi que le résultat obtenu.</p>
<p>Afin que les valeurs par défaut s’appliquent correctement, on fournira de préférence à <code class="docutils literal notranslate"><span class="pre">WidgetsDict()</span></code> ses arguments sous la forme d’un dictionnaire ne contenant que les arguments pour lesquels une valeur est effectivement disponible<a class="footnote-reference brackets" href="#defaultvalues" id="id1">1</a>.</p>
<p>Par exemple :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">plume.rdf.widgetsdict</span> <span class="kn">import</span> <span class="n">WidgetsDict</span>

<span class="n">kwa</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">if</span> <span class="n">metagraph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">kwa</span><span class="p">[</span><span class="s1">&#39;metagraph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metagraph</span>
<span class="k">if</span> <span class="n">template</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">kwa</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">template</span>
<span class="c1"># etc.</span>

<span class="n">widgetsdict</span> <span class="o">=</span> <span class="n">WidgetsDict</span><span class="p">(</span><span class="o">**</span><span class="n">kwa</span><span class="p">)</span>

</pre></div>
</div>
<section id="sources-de-donnees">
<h2>Sources de données<a class="headerlink" href="#sources-de-donnees" title="Lien permanent vers ce titre">¶</a></h2>
<section id="metagraph-le-graphe-des-metadonnees-pre-existantes">
<h3>metagraph : le graphe des métadonnées pré-existantes<a class="headerlink" href="#metagraph-le-graphe-des-metadonnees-pre-existantes" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les métadonnées pré-existantes sont déduites du descriptif PostgreSQL de la table ou de la vue, ci-après <code class="docutils literal notranslate"><span class="pre">pg_description_raw</span></code>. Elles sont supposées se trouver entre deux balises <code class="docutils literal notranslate"><span class="pre">&lt;METADATA&gt;</span></code> et <code class="docutils literal notranslate"><span class="pre">&lt;/METADATA&gt;</span></code>, et avoir été encodées au format JSON-LD.</p>
<p>Le module <span class="xref myst">plume.pg.queries</span> propose une requête pré-configurée <code class="docutils literal notranslate"><span class="pre">query_get_table_comment()</span></code>, qui permet d’obtenir le descriptif de l’objet :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">from</span> <span class="nn">plume.pg</span> <span class="kn">import</span> <span class="n">queries</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connection_string</span><span class="p">)</span>

<span class="k">with</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
    
        <span class="n">query</span> <span class="o">=</span> <span class="n">queries</span><span class="o">.</span><span class="n">query_get_table_comment</span><span class="p">(</span><span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">raw_pg_description</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</pre></div>
</div>
<p><em><code class="docutils literal notranslate"><span class="pre">connection_string</span></code> est la chaîne de connexion à la base de données PostgreSQL. <code class="docutils literal notranslate"><span class="pre">table_name</span></code> et <code class="docutils literal notranslate"><span class="pre">schema_name</span></code> sont respectivement le nom de la relation (table, vue, etc.) dont on souhaite importer les métadonnées et le nom du schéma auquel elle est rattachée.</em></p>
<p>Une fois le descriptif récupéré, on l’utilisera pour générer un objet de classe  <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">plume.pg.description.PgDescription</span></code></span>, ce qui a pour effet d’en extraire les métadonnées - s’il y en avait - et les dé-sérialiser en graphe de métadonnées.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">plume.pg.description</span> <span class="kn">import</span> <span class="n">PgDescription</span>

<span class="n">pg_description</span> <span class="o">=</span> <span class="n">PgDescription</span><span class="p">(</span><span class="n">raw_pg_description</span><span class="p">)</span>

</pre></div>
</div>
<p>Ce même objet <code class="docutils literal notranslate"><span class="pre">PgDescription</span></code> servira ultérieurement pour la création d’un nouveau descriptif PostgreSQL contenant les métadonnées mises à jour. Il mémorise en effet également le texte saisi hors des balises <code class="docutils literal notranslate"><span class="pre">&lt;METADATA&gt;</span></code>, qu’il s’agit de préserver. Cf. <span class="xref myst">Sauvegarde</span> pour plus de détails.</p>
<p>Le graphe de métadonnées, objet de classe <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">plume.rdf.metagraph.Metagraph</span></code></span>, est ensuite obtenu par un simple appel à la propriété <code class="docutils literal notranslate"><span class="pre">metagraph</span></code> de <code class="docutils literal notranslate"><span class="pre">pg_description</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">metagraph</span> <span class="o">=</span> <span class="n">pg_description</span><span class="o">.</span><span class="n">metagraph</span>

</pre></div>
</div>
<p>La propriété renverra un graphe vide si le descriptif PostgreSQL ne contenait pas les balises <code class="docutils literal notranslate"><span class="pre">&lt;METADATA&gt;</span></code> et <code class="docutils literal notranslate"><span class="pre">&lt;/METADATA&gt;</span></code> entre lesquelles est supposé se trouver le JSON-LD contenant les métadonnées. C’est typiquement ce qui arrivera lorsque les métadonnées n’ont pas encore été rédigées.</p>
<p>Si le contenu des balises n’est pas un JSON-LD valide, la propriété renverra également un graphe de métadonnées vide.</p>
</section>
<section id="template-le-modele-de-formulaire">
<h3>template : le modèle de formulaire<a class="headerlink" href="#template-le-modele-de-formulaire" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">template</span></code> est un objet de classe <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">plume.pg.template.TemplateDict</span></code></span> contenant les informations relatives au modèle de formulaire à utiliser.</p>
<p>Les modèles de formulaires sont définis à l’échelle du service et stockés dans la base PostgreSQL. Ils permettent :</p>
<ul class="simple">
<li><p>d’ajouter des catégories locales au schéma de métadonnées communes défini par <span class="xref myst">shape.ttl</span> ;</p></li>
<li><p>de restreindre les catégories communes à afficher ;</p></li>
<li><p>de substituer des paramètres locaux à ceux spécifiés par le schéma commun (par exemple remplacer le nom à afficher pour la catégorie de métadonnée, répartir les métadonnées dans plusieurs onglets…).</p></li>
</ul>
<p>Pour plus de détails sur les modèles de formulaire, on se reportera à la partie <span class="xref myst">Modèles de formulaire</span>, et plus particulièrement à sa sous-partie <span class="xref myst">Import par le plugin</span>, qui explique comment générer <code class="docutils literal notranslate"><span class="pre">template</span></code>.</p>
</section>
<section id="columns-les-descriptifs-des-champs">
<h3>columns : les descriptifs des champs<a class="headerlink" href="#columns-les-descriptifs-des-champs" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">columns</span></code> est la liste des champs de la table / vue courante. Plus précisément, il s’agit d’une liste de tuples dont le premier élément est le nom du champ et le second son descriptif, stocké tel quel en tant que descriptif PostgreSQL du champ.</p>
<p>Elle peut être obtenue ainsi :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">from</span> <span class="nn">plume.pg</span> <span class="kn">import</span> <span class="n">queries</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connection_string</span><span class="p">)</span>

<span class="k">with</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
    
        <span class="n">query</span> <span class="o">=</span> <span class="n">queries</span><span class="o">.</span><span class="n">query_get_columns</span><span class="p">(</span><span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</pre></div>
</div>
<p>Dans le formulaire résultant, chaque champ se trouvera représenté par un widget <code class="docutils literal notranslate"><span class="pre">QTextEdit</span></code> placé dans l’onglet <em>Champs</em>.</p>
</section>
<section id="data-les-metadonnees-calculees">
<h3>data : les métadonnées calculées<a class="headerlink" href="#data-les-metadonnees-calculees" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">data</span></code> est un dictionnaire contenant des informations actualisées à partir de sources externes (par exemple déduites des données) qui écraseront les valeurs présentes dans <code class="docutils literal notranslate"><span class="pre">metagraph</span></code>. Les clés du dictionnaire sont des chemins SPARQL identifiant des catégories de métadonnées, ses valeurs sont des listes contenant la ou les valeurs (<code class="docutils literal notranslate"><span class="pre">str</span></code>) à faire apparaître pour les catégories en question.</p>
<p>À ce stade, <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code> prend parfaitement en charge le paramètre <code class="docutils literal notranslate"><span class="pre">data</span></code>, mais aucun mécanisme d’alimentation en informations externes n’a été mis en place. On pourra donc considérer qu’il vaut toujours <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</section>
</section>
<section id="parametres-utilisateur">
<h2>Paramètres utilisateur<a class="headerlink" href="#parametres-utilisateur" title="Lien permanent vers ce titre">¶</a></h2>
<p>Sauf indication contraire, tous les paramètres utilisateur évoqués ci-après sont à récupérer dans les fichiers de configuration. Si un paramètre n’y est pas explicitement spécifié (parce que l’utilisateur n’a pas éprouvé le besoin de modifier le comportement par défaut), il ne devra pas non plus apparaître dans les arguments du constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code>.</p>
<section id="mode">
<h3>mode<a class="headerlink" href="#mode" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code> est un paramètre utilisateur au sens où il est déterminé par l’utilisateur, mais <strong>il ne doit pas être sauvegardé dans le fichier de configuration</strong>.</p>
<p>Comme détaillé dans <span class="xref myst">Actions générales</span>, il devra toujours valoir <code class="docutils literal notranslate"><span class="pre">'read'</span></code> (mode lecture) lors de l’ouverture initiale de la fiche. Si ses privilèges sont suffisants, l’utilisateur peut ensuite activer le mode édition, et <code class="docutils literal notranslate"><span class="pre">mode</span></code> vaudra alors <code class="docutils literal notranslate"><span class="pre">'edit'</span></code>.</p>
<p>Il est préférable de toujours spécifier explicitement ce paramètre dans la liste des arguments du constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code> (où sa valeur par défaut est <code class="docutils literal notranslate"><span class="pre">'edit'</span></code>).</p>
</section>
<section id="readhideblank">
<h3>readHideBlank<a class="headerlink" href="#readhideblank" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">readHideBlank</span></code> est un booléen indiquant si les champs vides doivent être masqués en mode lecture.</p>
<p>Le comportement naturel est de masquer ces champs, et c’est ce que fera le constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code> si ce paramètre n’est pas spécifié.</p>
</section>
<section id="readhideunlisted">
<h3>readHideUnlisted<a class="headerlink" href="#readhideunlisted" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">readHideUnlisted</span></code> est un booléen indiquant si, en mode lecture, il faut masquer les catégories qui n’apparaissent pas dans le modèle de formulaire à utiliser (cf. <span class="xref myst">template</span>) mais pour lesquelles des métadonnées ont été saisies antérieurement. Si aucun modèle n’est défini, les catégories concernées sont celles qui ne sont pas répertoriées dans le schéma des catégories communes.</p>
<p>Le comportement par défaut du constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code> est de masquer les champs en question.</p>
</section>
<section id="edithideunlisted">
<h3>editHideUnlisted<a class="headerlink" href="#edithideunlisted" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">editHideUnlisted</span></code> est le pendant de <code class="docutils literal notranslate"><span class="pre">readHideUnlisted</span></code> pour le mode édition.</p>
<p>C’est un booléen indiquant si, en mode édition, il faut masquer les catégories qui n’apparaissent pas dans le modèle de formulaire à utiliser (cf. <span class="xref myst">template</span>) mais pour lesquelles des métadonnées ont été saisies antérieurement. Si aucun modèle n’est défini, les catégories concernées sont celles qui ne sont pas répertoriées dans le schéma des catégories communes.</p>
<p>Le comportement par défaut du constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code> est d’afficher les champs en question.</p>
</section>
<section id="language">
<h3>language<a class="headerlink" href="#language" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">language</span></code> est une chaîne de caractères indiquant la langue principale de saisie des métadonnées. Ce paramètre peut être modifié via un widget dans l’interface fixe du plugin - cf. <span class="xref myst">Actions générales</span>.</p>
<p>Si <code class="docutils literal notranslate"><span class="pre">language</span></code> n’apparaît pas dans les arguments du constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code>, il sera considéré que les métadonnées sont saisies dans la première langue de la liste des langues autorisées, <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">langList</span></code></span>. Nonobstant, il est recommandé de toujours spécifier explicitement ce paramètre, afin d’assurer que la valeur utilisée par la fonction soit identique à celle qui apparaît dans la partie fixe de l’interface.</p>
<p>La documentation invitera l’utilisateur à privilégier les codes de langues sur deux caractères, comme attendu en RDF. Référence : <a class="reference external" href="https://www.iso.org/iso-639-language-codes.html">ISO 639</a>.</p>
<p>La langue principale de saisie des métadonnées a trois usages :</p>
<ul class="simple">
<li><p>les métadonnées identifiées comme traduisibles (par exemple le libellé du jeu de données et son descriptif sont traduisibles, mais pas sa date de création ni son identifiant) sont représentées en RDF avec une information sur leur langue<a class="footnote-reference brackets" href="#rdflangstring" id="id2">2</a>. Cette langue sera toujours la langue principale de saisie des métadonnées, sauf lorsque le mode traduction (cf. <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">translation</span></code></span>) est actif.</p></li>
<li><p>en mode lecture, lorsque des valeurs dans plusieurs langues sont disponibles pour une catégorie de métadonnées, le comportement par défaut de Plume est d’afficher uniquement les valeurs dans la langue principale (à défaut il tente les langues de <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">langList</span></code></span> dans l’ordre et, à défaut, choisit une langue disponible au hasard). Il est possible d’inhiber ce comportement avec le paramètre <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">readOnlyCurrentLanguage</span></code></span>, ou de forcer le même comportement en mode édition avec <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">editOnlyCurrentLanguage</span></code></span> ;</p></li>
<li><p>lorsqu’une métadonnées prend ses valeurs dans un thésaurus, lesdites valeurs sont représentées en RDF sous la forme d’URI. Ces URI sont référencés dans le fichier <span class="xref myst">vocabulary.ttl</span>, qui fournit pour chacun d’entre eux des libellés lisibles par un être humain. Il existe toujours un libellé en français et souvent en anglais. La langue principale de saisie détermine la langue des libellés affichés dans l’interface. À défaut de libellé dans la langue principale, les langues de <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">langList</span></code></span> sont testées dans l’ordre et, à défaut, une traduction est choisie au hasard.</p></li>
</ul>
</section>
<section id="translation">
<h3>translation<a class="headerlink" href="#translation" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">translation</span></code> est un booléen indiquant si le mode traduction est actif. Comme <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">language</span></code></span>, ce paramètre peut être modifié via un widget dans l’interface fixe du plugin - cf. <span class="xref myst">Actions générales</span>. Il est ignoré quand le dictionnaire n’est pas généré en mode édition (<span class="xref myst"><code class="docutils literal notranslate"><span class="pre">mode</span></code></span> valant <code class="docutils literal notranslate"><span class="pre">'edit'</span></code>).</p>
<p>Si <code class="docutils literal notranslate"><span class="pre">translation</span></code> n’apparaît pas dans les arguments du constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code>, il sera considéré que le mode traduction n’est pas actif. Nonobstant, il est recommandé de toujours spécifier explicitement ce paramètre, afin d’assurer que la valeur utilisée par la fonction soit identique à celle qui apparaît dans la partie fixe de l’interface.</p>
</section>
<section id="langlist">
<h3>langList<a class="headerlink" href="#langlist" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">langList</span></code> est une liste ou un tuple de chaînes de caractères qui donne les langues autorisées pour les traductions, en complément de la langue principale de saisie spécifiée par <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">language</span></code></span>. Il alimente aussi la liste de valeurs du widget qui, dans la partie fixe de l’interface, permet de choisir la langue principale <span class="xref myst">Actions générales</span>.</p>
<p>Si <code class="docutils literal notranslate"><span class="pre">langList</span></code> n’apparaît pas dans les arguments du constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code>, celui-ci utilisera le tuple <code class="docutils literal notranslate"><span class="pre">('fr',</span> <span class="pre">'en')</span></code> (français et anglais). Nonobstant, il est recommandé de toujours spécifier explicitement ce paramètre, afin d’assurer que la valeur utilisée par la fonction soit identique à celle qui apparaît dans la partie fixe de l’interface.</p>
</section>
<section id="readonlycurrentlanguage">
<h3>readOnlyCurrentLanguage<a class="headerlink" href="#readonlycurrentlanguage" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">readOnlyCurrentLanguage</span></code> est un booléen qui indique si, en mode lecture, seules les métadonnées saisies dans la langue principale doivent être affichées. Cf. <span class="xref myst">language</span> pour plus de détails.</p>
<p>Si <code class="docutils literal notranslate"><span class="pre">readOnlyCurrentLanguage</span></code> n’apparaît pas dans les arguments du constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code>, il sera considéré comme valant <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</section>
<section id="editonlycurrentlanguage">
<h3>editOnlyCurrentLanguage<a class="headerlink" href="#editonlycurrentlanguage" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">editOnlyCurrentLanguage</span></code> est le pendant de <code class="docutils literal notranslate"><span class="pre">readOnlyCurrentLanguage</span></code> pour le mode édition.</p>
<p>C’est un booléen indiquant si, en mode édition <strong>et lorsque le mode traduction n’est pas actif</strong>, seules les métadonnées saisies dans la langue principale doivent être affichées. Cf. <span class="xref myst">language</span> pour plus de détails.</p>
<p>Si <code class="docutils literal notranslate"><span class="pre">editdOnlyCurrentLanguage</span></code> n’apparaît pas dans les arguments du constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code>, il sera considéré comme valant <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</section>
<section id="labellengthlimit">
<h3>labelLengthLimit<a class="headerlink" href="#labellengthlimit" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">labelLengthLimit</span></code> est un entier qui indique le nombre de caractères au-delà duquel l’étiquette d’une catégorie de métadonnées sera toujours affiché au-dessus du widget de saisie et non sur la même ligne. À noter que pour les widgets <code class="docutils literal notranslate"><span class="pre">QTextEdit</span></code> le label est placé au-dessus quoi qu’il arrive.</p>
<p>Si <code class="docutils literal notranslate"><span class="pre">labelLengthLimit</span></code> n’apparaît pas dans les arguments du constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code>, le seuil est fixé à 25 caractères.</p>
</section>
<section id="valuelengthlimit">
<h3>valueLengthLimit<a class="headerlink" href="#valuelengthlimit" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">valueLengthLimit</span></code> est un entier qui indique le nombre de caractères au-delà duquel une valeur qui aurait dû être affichée dans un widget <code class="docutils literal notranslate"><span class="pre">QLineEdit</span></code> sera présentée à la place dans un <code class="docutils literal notranslate"><span class="pre">QTextEdit</span></code>. Indépendemment du nombre de caractères, la substitution sera aussi réalisée si la valeur contient un retour à la ligne.</p>
<p>Si <code class="docutils literal notranslate"><span class="pre">valueLengthLimit</span></code> n’apparaît pas dans les arguments du constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code>, le seuil est fixé à 65 caractères.</p>
</section>
<section id="texteditrowspan">
<h3>textEditRowSpan<a class="headerlink" href="#texteditrowspan" title="Lien permanent vers ce titre">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">textEditRowSpan</span></code> est un entier qui définit le nombre de lignes par défaut d’un widget <code class="docutils literal notranslate"><span class="pre">QTextEdit</span></code>, c’est-à-dire la valeur de <code class="docutils literal notranslate"><span class="pre">rowSpan</span></code> qui sera utilisée par le constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code> pour toutes les catégories telles que ni le modèle de formulaire ni le schéma des catégories communes ne fixe une valeur.</p>
<p>Si <code class="docutils literal notranslate"><span class="pre">textEditRowSpan</span></code> n’apparaît pas dans les arguments du constructeur de <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code>, la hauteur est fixée à 6 lignes.</p>
</section>
</section>
<section id="resultat-un-dictionnaire-de-widgets">
<h2>Résultat : un dictionnaire de widgets<a class="headerlink" href="#resultat-un-dictionnaire-de-widgets" title="Lien permanent vers ce titre">¶</a></h2>
<p>La classe <code class="docutils literal notranslate"><span class="pre">WidgetsDict</span></code> hérite de <code class="docutils literal notranslate"><span class="pre">dict</span></code> et définit des méthodes supplémentaires qui gèrent notamment l’actualisation du dictionnaire en fonction des actions de l’utilisateur (cf. <span class="xref myst">Actions contrôlées par les widgets du formulaire</span>).</p>
<p>En premier lieu, le dictionnaire de widgets sert de base à la génération du formulaire de saisie / consultation des métadonnées. Pour ce faire, on bouclera sur les clés du dictionnaire et créera au fur et à mesure les widgets qu’elles définissent, comme expliqué dans <span class="xref myst">Création d’un nouveau widget</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="p">{</span>
    <span class="n">widgetkey_1</span> <span class="p">:</span> <span class="n">dictionnaire_interne_1</span><span class="p">,</span>
    <span class="n">widgetkey_2</span> <span class="p">:</span> <span class="n">dictionnaire_interne_2</span>
<span class="p">}</span>

</pre></div>
</div>
<p>Chaque enregistrement du dictionnaire représente l’un objets des objets suivants du formulaire : une zone de saisie, un groupe de valeurs, un groupe de propriétés, un groupe de traduction, un bouton plus ou un bouton de traduction.</p>
<p>Les clés du dictionnaire de widgets sont des objets <code class="docutils literal notranslate"><span class="pre">plume.rdf.widgetkey.WidgetKey</span></code>. Elles forment une structure arborescente qui, y compris lorsque des widgets sont ajoutés, supprimés, masqués suite aux actions de l’utilisateur, assure que la cohérence du positionnement des widgets. Elle permet aussi de recréer aisément un graphe de métadonnées à partir du dictionnaire de widgets, en vu de l’enregistrement en JSON-LD des métadonnées actualisées.</p>
<p>Les valeurs du dictionnaire du widgets sont des objets <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">plume.rdf.internaldict.InternalDict</span></code></span>, dit « dictionnaires internes ». Cette classe présente des dictionnaires de structure homogène qui contiennent toutes les informations nécessaires à la création du ou des widgets associés à l’objet et seront également utilisés pour référencer chacun des widgets créés. Outre leur fonction de référencement, les dictionnaires internes servent essentiellement à traduire les informations portées par les <code class="docutils literal notranslate"><span class="pre">WidgetKey</span></code> sous une forme plus aisément exploitable par les bibliothèques de QT.</p>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="defaultvalues"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Ce sujet concerne surtout les paramètres booléens. Pour les autres, les valeurs par défaut sont appliquées dans le corps de la fonction d’initialisation et non déclarées dans les paramètres. Ainsi, elles s’appliqueront aussi dans le cas où une valeur <code class="docutils literal notranslate"><span class="pre">None</span></code> est explicitement fournie en argument.</p>
</dd>
<dt class="label" id="rdflangstring"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Ces catégories « traduisibles » sont celles dont le type est <code class="docutils literal notranslate"><span class="pre">rdf:langstring</span></code>. Ce type est spécificié par le schéma des métadonnées communes, <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">shape.ttl</span></code></span>, ou par le <span class="xref myst">modèle de formulaire</span> dans le cas d’une catégorie locale.</p>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Plume</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="usage.html">Usage</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Génération du dictionnaire des widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="creation_widgets.html">Création d’un nouveau widget</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions_widgets.html">Actions contrôlées par les widgets du formulaire</a></li>
<li class="toctree-l2"><a class="reference internal" href="outils_saisie_geometries.html">Outils d’aide à la saisie des géométries</a></li>
<li class="toctree-l2"><a class="reference internal" href="metadonnees_calculees.html">Métadonnées calculées</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions_generales.html">Actions générales</a></li>
<li class="toctree-l2"><a class="reference internal" href="modeles_de_formulaire.html">Modèles de formulaire</a></li>
<li class="toctree-l2"><a class="reference internal" href="parametres_utilisateur.html">Paramètres utilisateurs</a></li>
<li class="toctree-l2"><a class="reference internal" href="gestion_plume_pg.html">Installation et gestion de l’extension PostgreSQL <em>PlumePg</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="metadonnees_communes.html">Métadonnées communes</a></li>
<li class="toctree-l2"><a class="reference internal" href="conformite_geodcat_ap.html">Conformité au profil GeoDCAT-AP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/modules.html">Référence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mechanism/mechanism.html">Usage</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="usage.html">Usage</a><ul>
      <li>Previous: <a href="usage.html" title="Chapitre précédent">Usage</a></li>
      <li>Next: <a href="creation_widgets.html" title="Chapitre suivant">Création d’un nouveau widget</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, République française.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/usage/generation_dictionnaire_widgets.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>